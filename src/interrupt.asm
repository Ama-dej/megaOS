.CSEG
.ORG 0x0000
RESET_INT: JMP START
.ORG 0x0024
RX_COMPLETE_INT: JMP GETCHAR
.ORG 0x0028
TX_COMPLETE_INT: JMP PUTCHAR
.ORG 0x0034

GETCHAR:
	PUSH R16

	LDS R16, UDR0
	STS CHAR_BUFFER, R16

	POP R16
	RETI	

PUTCHAR:
	PUSH R16
	IN R16, SREG
	PUSH R16

	LDS R16, CHAR_BUFFER
	OR R16, R16
	BREQ PUTCHAR_OUT

	STS UDR0, R16
	CLR R16
	STS CHAR_BUFFER, R16

PUTCHAR_OUT:
	POP R16
	OUT SREG, R16
	POP R16
	RETI	

.DSEG
CHAR_BUFFER: .BYTE 1
