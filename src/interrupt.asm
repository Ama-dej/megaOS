.CSEG
.ORG 0x0000
RESET_INT: JMP START
.ORG 0x0024
RX_COMPLETE_INT: JMP RX_WRITE_TO_BUFFER 
.ORG 0x0028
TX_COMPLETE_INT: JMP TX_COMPLETE 
.ORG 0x0034

RX_WRITE_TO_BUFFER:
	PUSH R16
	IN R16, SREG
	PUSH R16
	PUSH XL
	PUSH XH

	LDS XL, WRITE_HEAD_L
	LDI XH, 0x01

	LDS R16, UDR0
	ST X+, R16

	ANDI XL, RX_BUFFER_SIZE - 1
		
	STS WRITE_HEAD_L, XL	

	LDS R16, RX_BUFFER_COUNT
	INC R16
	STS RX_BUFFER_COUNT, R16

	POP XH
	POP XL
	POP R16
	OUT SREG, R16
	POP R16
	RETI	

TX_COMPLETE:
	PUSH R16

	LDI R16, 0 
	STS TX_BUSY, R16

	POP R16
	RETI	
